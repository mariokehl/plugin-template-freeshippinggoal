function FreeShippingGoal(e){this.itemSum=e,this.message="",this.getConfig=function(){let e=JSON.parse(document.getElementById("free-shipping-config").textContent);return e},this.getGrossValue=function(){let e=this.getConfig();return e.grossValue},this.getItemSum=function(){if("number"==typeof this.itemSum)return this.itemSum;let e=this.getConfig();return e.initialData.amount},this.getGoalReachedMessage=function(){let e=this.getConfig();return e.messages.goal},this.getMissingMessage=function(e){let t=this.getConfig(),i=t.messages.missing;return(i=i.replace(":amount",Intl.NumberFormat("de-DE",{maximumFractionDigits:2,minimumFractionDigits:2}).format(e))).replace(":currency",t.currency)},this.getPercentage=function(){let e=this.getItemSum()/this.getGrossValue()*100;return(e=Math.floor(e))>100?100:e},this.syncGrossValue=function(){let e=this.getConfig();return $.getJSON("/plugin/free-shipping-goal/current/",function(t){e.grossValue=t.minimumGrossValue,document.getElementById("free-shipping-config").textContent=JSON.stringify(e)})},this.calc=function(e){let t=this;this.syncGrossValue().then(function(){let i=document.querySelectorAll(".free-shipping-container")[0];t.getGrossValue()?i.classList.contains("d-shipping-country-none")||(i.style.display="block"):i.style.display="none";let n="";e.style.display="none";let s=t.getGrossValue()-t.getItemSum();n=s<=0?t.getGoalReachedMessage():t.getMissingMessage(s);let l=t.getPercentage(),o=document.querySelectorAll('[role="progressbar"]')[0];o.setAttribute("aria-valuenow",l),o.style.width=l+"%";let r=t.getConfig();s<=0?(o.classList.remove(r.classes.missingAmount),o.classList.add(r.classes.reachedAmount)):(o.classList.remove(r.classes.reachedAmount),o.classList.add(r.classes.missingAmount)),e.innerHTML=n,e.style.display="block"})},this.init=function(){let e=this.getConfig();this.itemSum&&(e.initialData.amount=this.itemSum,e.initialData.percentage=this.getPercentage(),document.getElementById("free-shipping-config").textContent=JSON.stringify(e))},this.setLabel=function(){let e=document.getElementsByClassName("free-shipping-missing-amount");if(e.length){let t=this;Array.prototype.forEach.call(e,function(e){t.calc(e)})}else{this.init();return}},this.toggle=function(e){let t=this.getConfig(),i=t.excludedShippingCountries,n;n=i.includes(e)?"none":"block",Array.prototype.forEach.call(document.querySelectorAll(".free-shipping-container"),function(e){e.classList.remove("d-shipping-country-none"),e.classList.remove("d-shipping-country-block"),e.style.display=n,e.classList.add("d-shipping-country-"+n)})}}function waitForElement(e){return new Promise(t=>{if(document.querySelector(e))return t(document.querySelector(e));let i=new MutationObserver(n=>{document.querySelector(e)&&(t(document.querySelector(e)),i.disconnect())});i.observe(document.body,{childList:!0,subtree:!0})})}function toFloat(e){let t=e.indexOf(".");t<0&&(t=0);let i=e.indexOf(",");i<0&&(i=0);let n;return!1==(n=t>i&&t?t:i>t&&!!i&&i)?parseFloat(e.replace(/[^\d]/g,"")):parseFloat(e.substr(0,n).replace(/[^\d]/g,"")+"."+e.substr(n+1,e.length).replace(/[^0-9]/,""))}window.addEventListener("load",()=>{let e=new FreeShippingGoal(null);e.setLabel()},!1),waitForElement(".basket-preview").then(()=>{let e=new FreeShippingGoal(null);e.setLabel()}),document.addEventListener("afterBasketItemAdded",e=>{let t=document.querySelector(".toggle-basket-preview .badge").textContent,i=toFloat(t),n=new FreeShippingGoal(i);n.setLabel()},!1),document.addEventListener("afterBasketChanged",e=>{let t=e.detail,i=t.itemSum+("promotion"===t.couponCampaignType?t.couponDiscount:0),n=new FreeShippingGoal(i);n.setLabel()},!1),document.addEventListener("afterShippingCountryChanged",e=>{let t=parseInt(e.detail),i=new FreeShippingGoal(null);i.toggle(t)});